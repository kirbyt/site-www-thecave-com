<!DOCTYPE html>
<html lang="en">

<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="thecave.com is the blog site for Kirby Turner, an independent software developer for Mac and iOS.">

    <title>How to Unit Testing Implementations of an Interface - thecave | Ramblings From A Crotchety Old Man</title>

    <link rel="canonical" href="http://www.thecave.com/2004/06/01/how-to-unit-testing-implementations-of-an-interface/">
    <link rel="alternate" type="application/atom+xml" title="thecave | Ramblings From A Crotchety Old Man's Feed" href="http://www.thecave.com/feed.xml" />


    <!-- Bootstrap Core CSS -->
    <link rel="stylesheet" href="/css/bootstrap.min.css">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/clean-blog.css">

    <!-- Pygments Github CSS -->
    <link rel="stylesheet" href="/css/syntax.css">

    <!-- YouTube CSS -->
    <link rel="stylesheet" href="/css/video.css">

    <!-- Custom Fonts -->
    <link href="http://maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">
    <link href='http://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
    <link href='http://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/css'>

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

</head>


<body>

    <!-- Navigation -->
<nav class="navbar navbar-default navbar-custom navbar-fixed-top">
    <div class="container-fluid">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header page-scroll">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/">thecave</a>
        </div>

        <!-- Collect the nav links, forms, and other content for toggling -->
        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a href="/">Home</a>
                </li>
                
                <li>
                    <a href="/about.html">About</a>
                </li>
                
                <li>
                    <a href="/archive.html">Archive</a>
                </li>
                
                <li>
                    <a href="/categories.html">Categories</a>
                </li>
                
            </ul>
        </div>
        <!-- /.navbar-collapse -->
    </div>
    <!-- /.container -->
</nav>


    <!-- Post Header -->
<header class="intro-header" style="background-image: url('/img/bg-02.jpg')">
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <div class="post-heading">
                    <h1>How to Unit Testing Implementations of an Interface</h1>
                    
                    <span class="meta">Posted by Kirby Turner on June 1, 2004</span>
                </div>
            </div>
        </div>
    </div>
</header>

<!-- Post Content -->
<article>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">

				<p>I have become a firm supporter of writing unit tests for most if not all code I write, and <a href="http://www.nunit.org">NUnit</a> is an ideal framework for implementing unit tests.  But one problem I have had repeatedly is finding a good way to test specific implementations of an interface.  My approach has always been to write a new test fixture for each implementor of an interface.  But the problem with this approach is that I end up duplicating unit tests for each implementor, and if I need to write a new test I have to copy it to multiple fixtures.</p>

<p>As a programmer I consider myself lazy.  I don’t like having to write the same code over and over.  Instead I would rather write it once and forget about it.  Having to write multiple test fixtures for each implementor of an interface doesn’t suit my lazy style.  I need a better approach and a quick google.com search pointed me in the right direction.</p>

<p>I came across a blog from <a href="http://blog.dotnetwiki.org/">Jonathan de Halleux</a> that talks about <a href="http://blog.dotnetwiki.org/archive/2004/05/13/206.aspx">composite unit testing using MbUnit</a>.  Jonathan presents an approach that splits the testing effort by class functionality rather than writing a test fixture for each class.  This is exactly what I am looking for but as much as I like this approach and MbUnit I still have one issue.  I want an approach that works with NUnit and does not require another framework such as MbUnit.</p>

<p>The development environment I have created for my customer is solid and I do not want to introduce new problems by introducing a new framework, in the case MbUnit.  In other words, I do not want to change what has been currently written including the NAnt build scripts.  So I did the next best thing.  I took Jonathan’s design and wrote a helper class to provide composite unit testing and include this class in my unit test projects.</p>

<p>Introducing CompositeTestFixture, a class that enables composite unit testing within NUnit test fixtures.  Because this is a class and not a new framework there are limitations but the limitations do not affect the unit tests I am writing today.  I will discuss the limitation later in this article.</p>

<p>To use CompositeTestFixture, begin by writing your test fixtures as you normally would.  In the spirit of Jonathan’s blog I will show an example that provides a test for implementors of the IEnumerable interface.  In this example I will show how to test the ArrayList and Hashtable classes which both implement this interface.  The only requirement in this test is that the IEnumerable instance is not null.</p>

<pre><code>using System;
using System.Collections;
using System.Diagnostics;

using NUnit.Framework;

namespace Samples.FunWithNUnit.MyClassLibrary.UnitTests
{
    [TestFixture]
    public class EnumerableTest
    {
        [Test]
        public void GetEnumeratorNotNull()
        {
            // Write unit test here.
        }
    }
}
</code></pre>

<p>Now we need to write the unit test for the GetEnumeratorNotNull test.  However we must first tell CompositeTestFixture about the factories needed to create an instance of class that implements the interface to test.  I call the instance of the class the implementor.</p>

<pre><code>[TestFixture]
[ProviderFactory(FactoryType=typeof(ArrayListFactory),
ReturnType=typeof(IEnumerable))]
[ProviderFactory(FactoryType=typeof(HashtableFactory),
ReturnType=typeof(IEnumerable))]
public class EnumerableTest
{
    ...
}
</code></pre>

<p>Next we need to write the code that will test the implementor.  The NUnit framework is going to call the GetEnumeratorNotNull method that is decorated with the [Test] attribute.  This is where we call into the CompositeTestFixture helper class.  A static method RunTest is provided for those who do not want to create an instance of the CompositeTestFixture class.</p>

<pre><code>[Test]
public void GetEnumeratorNotNull()
{
    CompositeTestFixture.RunTest( this );
}
</code></pre>

<p>Now we write the method that will perform the actual test.  This method will have the same name as the test method.  The only difference is that the method signature takes a single parameter of the interface type we are testing.  Note that this method is not decorated with the [Test] attribute since we do not want NUnit calling this method.</p>

<pre><code>public void GetEnumeratorNotNull( IEnumerable en )
{
    Debug.WriteLine( "Testing " + en.GetType().ToString() );
    Assert.IsNotNull( en.GetEnumerator(), "Must not be null." );
}
</code></pre>

<p>That’s it.  CompositeTestFixture will do all the heavy work of calling the appropriate unit test method to test a specific implementor.</p>

<h2 id="how-does-this-work">How Does This Work</h2>

<p>CompositeTestFixture will reflect on the class instances provided in the RunTest method call and retrieve the collection of ProviderFactory attributes decorating the test fixture.  Each factory declared by the FactoryType property will be called to create an instance of a class that implements the type defined in the ReturnType property.  In other words the factory will be used to create an instance of an implementor.</p>

<p>A factory can declare one or more methods that return an instance object.  I call these methods creators since each is responsible for creating a instance of a class.  Having multiple creators gives the unit test writer the option to provide implementors that are initialized differently.  For example one creator might return an empty ArrayList while a second creator might return an ArrayList filled with random numbers.</p>

<p>CompositeTestFixture determines creators by inspecting the factory class type and discovering each method with a return type that implements the type defined in the ProviderFactory.ReturnType property that decorates the test fixture.  Creators must be defined with a public scope and no parameters on the method signature.</p>

<pre><code>using System;
using System.Collections;

namespace Samples.FunWithNUnit.MyClassLibrary.UnitTests
{
    public class ArrayListFactory
    {
        public ArrayList CreateEmpty()
        {
            return new ArrayList();
        }

        public ArrayList RandomFilled()
        {
            ArrayList list = new ArrayList();
            Random rnd = new Random();
            for(int i=0;i&amp;lt;15;++i)
            {
                list.Add(rnd.Next());
            }
            return list;
        }
    }
}
</code></pre>

<p>After CompositeTestFixture calls a factory creator it calls the unit test method matching the name of the [Test] method that invoked CompositeTestFixture.RunTest( this ).  In our example this is the GetEnumeratorNotNull( IEnumerable en ) method.  This is repeated for each creator declared on a factory and for each factory declared on the fixture.</p>

<h2 id="limitations">Limitations</h2>

<p>Although this approach works for many cases it is not perfect.  The SetUp and TearDown methods of the fixture will only be called when NUnit calls the wrapper test method.  CompositeTestFixture does not call the SetUp and TearDown methods before and after calling the internal test method, although it would not be hard to add that feature.</p>

<h2 id="conclusion">Conclusion</h2>

<p>With the CompositeTestFixture helper class, I now have an easy way to provide composite unit testing within introducing a new framework into my development environment.  Hopefully you will find this code as useful as I have.  Click <a href="/downloads/CompositeTestFixture.zip">here</a> to download the complete source code.</p>


                <p>Posted in <a href='/category/blogger/'>blogger</a>.</p>

                <hr>

                <ul class="pager">
                    
                    <li class="previous">
                        <a href="/2004/05/28/a-comment-or-two-on-visual-studio-team-system/" data-toggle="tooltip" data-placement="top" title="A comment or two on Visual Studio Team System">&larr; Previous Post</a>
                    </li>
                    
                    
                    <li class="next">
                        <a href="/2004/06/01/rail-runtime-assembly-instrumentation-library-project/" data-toggle="tooltip" data-placement="top" title="RAIL - Runtime Assembly Instrumentation Library Project">Next Post &rarr;</a>
                    </li>
                    
                </ul>

            </div>
        </div>
    </div>
</article>

<p>&nbsp;</p>


    <!-- Footer -->
<footer>
    <div class="container">
        <div class="row">
            <div class="col-lg-5 col-lg-offset-1 col-xs-12">
                <h3>Recent Articles</h3>
                <ul>
                
                <li><a href="/2015/03/09/driver-x/" title="Driver X">Driver X</a></li>
                
                <li><a href="/2015/03/09/i-feel-guilty-but/" title="I Feel Guilty But">I Feel Guilty But</a></li>
                
                <li><a href="/2015/03/05/apres-code-a-new-developer-meetup-in-stowe-vt/" title="Après Code: A New Developer Meetup In Stowe Vt">Après Code: A New Developer Meetup In Stowe Vt</a></li>
                
                <li><a href="/2015/03/05/the-snow-was-better-in-2003/" title="The Snow Was Better In 2003">The Snow Was Better In 2003</a></li>
                
                <li><a href="/2015/03/04/life-is-a-vacation/" title="Life Is A Vacation">Life Is A Vacation</a></li>
                
                </ul>                
            </div>
            <div class="col-lg-5 col-lg-offset-1 col-xs-12">
                <h3>Other Sites</h3>
                <ul>
                    <li><a href="https://www.flickr.com/photos/kirbyturner/">Photos</a></li>
                    <li><a href="http://photos.thecave.com/">And More Photos</a></li>
                    <li><a href="http://www.rowanturner.net/">Rowan Turner</a></li>
                    <li><a href="http://www.kirbyturner.com/">Kirby Turner</a></li>
                    <li><a href="http://www.whitepeaksoftware.com/">White Peak Software</a></li>
                </ul>
            </div>
        </div>
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <br />
                <ul class="list-inline text-center">
                    <li>
                        <a href="/feed.xml">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-rss fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    
                    <li>
                        <a href="https://alpha.app.net/kirbyt">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-adn fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    <li>
                        <a href="https://twitter.com/kirbyt">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-twitter fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    
                    <li>
                        <a href="https://github.com/kirbyt">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    <li>
                        <a href="http://www.linkedin.com/in/kirbyt/">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-linkedin fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    
                </ul>
                <p class="copyright text-muted">Copyright &copy; Kirby Turner 2015</p>
            </div>
        </div>
    </div>
</footer>

<!-- jQuery -->
<script src="/js/jquery.min.js "></script>

<!-- Bootstrap Core JavaScript -->
<script src="/js/bootstrap.min.js "></script>

<!-- Custom Theme JavaScript -->
<script src="/js/clean-blog.min.js "></script>


</body>

</html>
